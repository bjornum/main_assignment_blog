{% extends "base.html" %} {% block title %}{{ post['title'] }}{% endblock %} {%
block content %}

<a href="{{ url_for('main.home') }}">← Back to all posts</a>
<article>
  <img
    src="https://picsum.photos/id/{{ 100 + post['id'] }}/1200/400"
    alt="Post Image"
    style="width: 100%; height: auto; border-radius: 8px; margin-bottom: 1rem"
  />
  <h2>{{ post['title'] }}</h2>

  <small>Published: {{ post['pub_date'] }}</small>
  <p>{{ post['content'] }}</p>

  {% if post['tags'] %}
  <p>
    Tags: {% for tag in post['tags'].split(',') %}
    <a href="{{ url_for('main.tag_page', tag_name=tag|trim) }}">{{ tag }}</a>
    {% endfor %}
  </p>
  {% endif %}
</article>

<hr />

{% if session.role == 'admin' %}
<div class="post-buttons">
  <a
    href="{{ url_for('main.edit_post', post_id=post['id']) }}"
    class="button-link"
  >
    ✏️ Edit Post
  </a>

  <form
    action="{{ url_for('main.delete_post', post_id=post['id']) }}"
    method="post"
    onsubmit="return confirm('Are you sure you want to delete this post?');"
  >
    <button type="submit" class="button-danger">🗑️ Delete Post</button>
  </form>
</div>
<hr />
{% endif %}

<section>
  <h3>Comments</h3>
  {% if comments %} {% for c in comments %}
  <div style="margin-bottom: 1em">
    <strong>{{ c['title'] }}</strong> <small>{{ c['pub_date'] }}</small>
    <p>{{ c['content'] }}</p>

    {% if session.role == 'admin' %}
    <form
      action="{{ url_for('main.delete_comment', comment_id=c['id']) }}"
      method="post"
      onsubmit="return confirm('Are you sure you want to delete this comment?');"
    >
      <button type="submit" class="button-danger">🗑️ Delete</button>
    </form>
    {% endif %}
  </div>
  {% endfor %} {% else %}
  <p>No comments yet.</p>
  {% endif %}
</section>

<hr />

<section>
  <h3>Add a Comment</h3>
  <form method="post">
    <label for="title">Title:</label><br />
    <input type="text" name="title" id="title" /><br /><br />

    <label for="content">Comment:</label><br />
    <textarea name="content" id="content" rows="4"></textarea><br /><br />

    <button type="submit">Submit</button>
  </form>
</section>
{% endblock %}
